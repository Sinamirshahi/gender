- revisit underflow detection
- add optional smoothing for frequencies
